version: 0.2
env:
  variables:
    db: ""
phases:
  pre_build:
    commands:
      - sudo apt update
      - sudo apt install jq -y
      - DB_NAME=$(aws ssm get-parameters --name /aryan/dbname --profile aryan --query "Parameters[0]" | jq -r .Value)
      - DB_USER=$(aws ssm get-parameters --name /aryan/dbname --profile aryan --query "Parameters[0]" | jq -r .Value)
      - DB_PASSWD=$(aws ssm get-parameters --name /aryan/dbpassword --with-decryption --profile aryan --query "Parameters[0]" | jq -r .Value)
      - DB_HOST=$(aws ssm get-parameters --name /aryan/dbhost --profile aryan --query "Parameters[0]" | jq -r .Value)
      - echo $DB_HOST $DB_PASSWD $DB_USER $DB_NAME
      - sudo sed -i 's/database_name_here/'$DB_NAME'/' wp-config.php
      - sudo sed -i 's/username_here/'$DB_USER'/' wp-config.php
      - sudo sed -i 's/password_here/'$DB_PASSWD'/' wp-config.php
      - sudo sed -i 's/localhost/'$DB_HOST'/' wp-config.php
      - cat wp-config.php


  build:
    commands:
      - echo Build Completed on `date`
  post_build:
    commands:
      - echo Congratulations!!!!!
      - cat wp-config.php


artifacts:
  files:
    - '**/*'
